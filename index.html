<!DOCTYPE html>
<html>
    <head>
        <title>Form with W3.CSS Template</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="bootstrap/css/indexcss.css" rel="stylesheet">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
        <script type="text/javascript" src="bootstrap/js/indexjs.js"></script>
    </head>
    <body>
	<div id="firstI">
        <div class="container">
            <div class="titre">
                <label class="titre_label" for="titre" onclick="reloadResponse()">Audio converter</label>
            </div>
            <form name="f2" method="post" action="donnee.php" class="w3-container">
                <div class="formulaire">
                    <div class="information">
                        <label class="information">Vous pouvez convertir un audio en texte à partir d'un lien youtube, 
                            ou en téléversant votre fichier audio.
                        </label>
                    </div>
                    <div class="upload">
                        <div class="video_url_container">
                            <div class="video_url">
                                <label for='url'>URL:</label>
                                <div class="barre_url">
                                    <input class="url" type="text" name="url" id='url'/></p>
                                </div>
                            </div>
                        </div>
                        <div class="fichier_audio_container">
                            <div class="fichier_audio">
                                <label>Fichier:</label>
                                <!-- image-preview-filename input [CUT FROM HERE]-->
                                <div class="input-group image-preview">
                                    <input type="text" class="form-control image-preview-filename" disabled="disabled"> <!-- don't give a name === doesn't send on POST/GET -->
                                    <span class="input-group-btn">
                                        <!-- image-preview-clear button -->
                                        <button type="button" class="btn btn-default image-preview-clear" style="display:none;">
                                            <span class="glyphicon glyphicon-remove"></span> Clear
                                        </button>
                                        <!-- image-preview-input -->
                                        <div class="btn btn-default image-preview-input">
                                            <span class="glyphicon glyphicon-folder-open"></span>
                                            <span class="image-preview-input-title">Browse</span>
                                            <input onchange="processAudio()" type="file" name="input-file-preview" id="fichier"/> <!-- rename it -->
                                        </div>
                                    </span>
                                </div><!-- /input-group image-preview [TO HERE]--> 
                            </div>                        
                        </div>
                        <div class="bouton">
                            <button id="submit"  name="submit" type="submit" class="btn btn-success">Envoyer</button>
                        </div>
                    </div>
                </div>
                
            </form>
      </div>
	  
	  </div>
	  <div id="secondI" style="display:none;">
	  <div class="container retour">
            <div class="titre">
                <label class="titre_label" for="titre">Audio converter</label>
            </div>
            <form name="f2" method="post" action="donnee.php" class="w3-container form_retour">
                <div class="formulaire_retour">
                    <div class="affichage">
                        <div class="titre_video">
                            <label class="titre_video"></label>
                        </div>
                        <div class="miniature">
                            <div class="col-md-8">
                                <div class="vid">
                                    <iframe width="350" height="200" src="https://www.youtube.com/embed/ac7KhViaVqc" allowfullscreen=""></iframe>
                                </div><!--./vid -->                                    
                            </div><!--.col -->
                        </div>
                        <div class="affichage_texte">
                            <div class="lbl_recherche_mot">
                                <label class="label_recherche_mot">Transcription de l'audio en texte :</label>
                            </div>
                            <div class="affichage_zone_texte">
                                <input type="text" class="zone_text">
                            </div>                            
                        </div>
                    </div>
                    <div class="recherche">   
                        <div class="section1">
                            <div class="section_recherche_mot">
                                <div class="recherche_mot">
                                    <input type="text" class="zone_rech_mot">
                                </div>
                                <div class="bouton_recherche">
                                    <button id="submit" name="submit" type="submit" class="btn btn-success btn_recherche">Rechercher</button>
                                </div>
                            </div>                            
                        </div>
                        <div class="section2">
                            <div class="section_affichage_mot">
                                <div class="nb_occurences">
                                    nb occurences
                                </div>
                                <div class="temps">
                                    <!-- <textarea class="affichage_temps" name="affichage_temps" rows="5" cols="33"></textarea> -->
                                </div>
                            </div> 
                        </div>
                    </div>
                    
                </div>                   
            </form>
        </div>
		</div>
        <script type="text/javascript">
			function reloadResponse(){
				var myNode = document.getElementById("firstI");
				while (myNode.firstChild) {
					myNode.removeChild(myNode.firstChild);
				}
				document.getElementById("secondI").style.display = "inline";
			}
		
			function processAudio(){
				const audioFile = window.URL.createObjectURL(document.getElementById('fichier').files[0]);
				
				var audioTag = document.createElement('div');
				audioTag.innerHTML = "<p>This is the original file</p><audio controls><source src='"+ audioFile +"' type='audio/ogg'>'"+audioFile+"'</audio><p>This is the altered file</p><audio crossOrigin='anonymous' controls id='alteredAudio'><source src='"+ audioFile +"' type='audio/ogg'>'"+audioFile+"'</audio>";
				var audioSpace = document.getElementById("audio_space");
				audioSpace.appendChild(audioTag);
				
				//Audio processing logic
				var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				var player = document.getElementById("alteredAudio");
				
				var mediaElement = player;

				var gainNode = audioCtx.createGain();
				var lowpass = audioCtx.createBiquadFilter();
				var highpass = audioCtx.createBiquadFilter();

				source = audioCtx.createMediaElementSource(mediaElement);
				source.connect(lowpass);
				lowpass.connect(highpass);
				highpass.connect(gainNode);
				gainNode.connect(audioCtx.destination);

				lowpass.type = "highpass";
				lowpass.frequency.value = 500;
				lowpass.gain.value = -1;
				highpass.type = "lowpass";
				highpass.frequency.value = 5000;
				highpass.gain.value = -1;
				
			}
        </script>
		
    </body>
</html>